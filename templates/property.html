{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Property Details</title>
    <link rel="stylesheet" href="{% static 'property_styles.css' %}">
</head>
<body>
    <div class="header">
        <div class="links">
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'search' %}">Search Properties</a>
            <a href="{% url 'favorites' %}">Favorites</a>
            {% if user.is_authenticated %}
            <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit">Log Out</button>
            </form>
            {% else %}
                <a href="{% url 'login' %}">Log In</a>
                <a href="{% url 'signup' %}">Sign Up</a>
            {% endif %}
        </div>
    </div>

    <div class="main_info">
        <div>
            {% if sales %}
                {% for sale in sales %}
                    <h1>${{ sale.price }}</h1>
                {% endfor %}
            {% endif %}
            <p>{{ prop.prop_id.address }}</p>
            {% if condo == True %}
                <a href="{% url 'condo' prop.condo.id %}">View this condo project</a>
            {% endif %}
        </div>
        <form method="post">
            {% csrf_token %}
            {% if is_favorite %}
                <button type="submit" name = "remove_from_favorites" class="btn btn-primary">Remove from Favorites</button>
            {% else %}
                <button type="submit" name = "add_to_favorites" class="btn btn-primary">Add to Favorites</button>
            {% endif %}
        </form>
    </div>

    <div class="details">
        <div class="property_details">
            {% for key, value in details.items %}
                {% if key == 'District' %}
            <div class="detail_container" onclick="window.location.href='/district/{{ prop.district.id }}'">
                {% else %}
                    <div class="detail_container">
                {% endif %}
                <div class="key">
                    <p>{{ key }}</p>
                </div>
                <div class="value">
                    {% if value %}
                    <p>{{ value }}</p>
                    {% else %}
                    <p>No data</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="property_affiliates">
            {% if sales %}


            {% for sale in sales %}
            <div class="affiliate_container" onclick="window.location.href='/realtor/{{ sale.realtor.id }}'">
                <div class="affiliate_title">
                    <p> Most Recent Sale Data:</p>
                </div>
                <div class="affiliate_name">
                    <p> ${{ sale.price }}</p>
                </div>
            </div>
            <div class="affiliate_container" onclick="window.location.href='/realtor/{{ sale.realtor.id }}'">
                <div class="affiliate_title">
                    <p>{{ sale.realtor.company.name }}</p>
                </div>
                <div class="affiliate_name">
                    <p>{{ sale.realtor.first_name }} {{ sale.realtor.last_name }}</p>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>No sale data available for this property.</p>
        {% endif %}

        </div>
    </div>



    <div class="comments">
        <h1>Comments</h1>
        <form method="post">
            {% csrf_token %}
            <textarea name="comment" placeholder="Add a comment..." required></textarea>
            <button type="submit" name="add_comment">Submit</button>
        </form>
        {% for comment in comments %}
<div class="comment_container" id="comment-{{ comment.id }}">
    <h3>{{ comment.user.username }}</h3>
    <p class="comment-text">{{ comment.comment }}</p>

    {% if comment.user.id == user.id %}
        <form method="post" id="editdelete-form-{{ comment.id }}" style="display: block;">
            {% csrf_token %}
            <input type="hidden" name="comment_id" value="{{ comment.id }}">
            <button type="button" onclick="showEditForm({{ comment.id }})">Edit</button>
            <button type="submit" name="delete_comment">Delete</button>
        </form>

        <form method="post" class="edit-form" id="edit-form-{{ comment.id }}" style="display: none;">
            {% csrf_token %}
            <input type="hidden" name="comment_id" value="{{ comment.id }}">
            <textarea name="updated_comment">{{ comment.comment }}</textarea>
            <button type="submit" name="save_comment">Save</button>
            <button type="button" onclick="cancelEdit({{ comment.id }})">Cancel</button>
        </form>
        {% endif %}
        </div>
        {% endfor %}
    </div>
    <script>
function showEditForm(commentId) {
    const container = document.getElementById(`comment-${commentId}`);
    const commentText = container.querySelector('.comment-text');
    const editForm = document.getElementById(`edit-form-${commentId}`);
    const editdelete = document.getElementById(`editdelete-form-${commentId}`);

    commentText.style.display = 'none';
    editForm.style.display = 'block';
    editdelete.style.display = 'none';
}

function cancelEdit(commentId) {
    const container = document.getElementById(`comment-${commentId}`);
    const commentText = container.querySelector('.comment-text');
    const editForm = document.getElementById(`edit-form-${commentId}`);
    const editdelete = document.getElementById(`editdelete-form-${commentId}`);

    editForm.style.display = 'none';
    commentText.style.display = 'block';
    editdelete.style.display = 'block';
}
</script>

</body>
</html>
