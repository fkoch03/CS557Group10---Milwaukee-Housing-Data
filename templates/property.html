{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Property Details</title>
    <link rel="stylesheet" href="{% static 'property_styles.css' %}">
</head>
<body>
    <div class="header">
        <div class="links">
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'search' %}">Search Properties</a>
            <a href="{% url 'favorites' %}">Favorites</a>
            {% if user.is_authenticated %}
            <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit">Log Out</button>
            </form>
            {% else %}
                <a href="{% url 'login' %}">Log In</a>
                <a href="{% url 'signup' %}">Sign Up</a>
            {% endif %}
        </div>
    </div>

    <div class="main_info">
        <div>
            <p>{{ prop.prop_id.address }}</p>
        </div>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="add_to_favorites" value="true">
            <button type="submit" class="btn btn-primary">Add to Favorites</button>
        </form>
    </div>

    <div class="details">
        <div class="property_details">
            {% for key, value in details.items %}
            <div class="detail_container">
                <div class="key">
                    <p>{{ key }}</p>
                </div>
                <div class="value">
                    {% if value %}
                    <p>{{ value }}</p>
                    {% else %}
                    <p>No data</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="property_affiliates">
            {% if sales %}
                <p>Most recent sale data:</p>
            {% for sale in sales %}
            <div class="affiliate_container" onclick="window.location.href='/realtor/{{ sale.realtor.id }}'">
                <div class="affiliate_title">
                    <p>{{ sale.realtor.company.name }}</p>
                </div>
                <div class="affiliate_name">
                    <p>{{ sale.realtor.first_name }} {{ sale.realtor.last_name }}</p>
                </div>
                <div class="affiliate_name">
                    <p>${{ sale.price }}</p>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>No sale data available for this property.</p>
        {% endif %}

        </div>
    </div>



    <div class="comments">
        <h1>Comments</h1>
        <form method="post">
            {% csrf_token %}
            <textarea name="comment" placeholder="Add a comment..." required></textarea>
            <button type="submit" name="add_comment">Submit</button>
        </form>
        {% for comment in comments %}
        <div class="comment_container">
            <h3>{{ comment.user.username }}</h3>
            <p>{{ comment.content }}</p>
        </div>
        {% endfor %}
    </div>
</body>
</html>
